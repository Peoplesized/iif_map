<!doctype html>
<html lang='en-GB'>
<head>
  <meta charset='utf-8'>
  <title>UNCCD IIF Maps</title>
  <link rel="stylesheet" type="text/css" href="ext/normalize.css">
  <link rel="stylesheet" type="text/css" href="ext/webflow.css">
  <link rel="stylesheet" type="text/css" href="css/unccd.css">
  <link rel="stylesheet" type="text/css" href="ext/jquery-jvectormap-2.0.4.css">
  <link rel="stylesheet" type="text/css" href="ext/chosen.min.css">
  <link rel="stylesheet" type="text/css" href="css/styles.css">
</head>

<body>
  <div id='container' class="w-row container">

  </div>

  <script id='explorer' type="text/html">
    <div class="w-col w-col-4 controls">
      {{>partyDetailPartial}}
      {{>summaryPartial}}
    </div>
    <div class="w-col w-col-8 content">
      <div class="map">
        {{>searchPartial}}
      </div>
    </div>
  </script>

  <!-- COUNTRY DETAIL PARTIAL -->
  <script id='partyDetailPartial' type="text/html">
    {{#selectedParty}}
      <div class="detail">
        <button on-click='set("selectedParty", false)' class='back'>&lt; Back</button>
        <div class='party-name'>{{selectedParty ? selectedParty.get('party') : ''}}</div>
        <div class='status'>IIF status <span class='status-label'>{{iif_or_plan}}</span></div>
        <div class='plan'>{{#if iif_plan_start}}IIF planned: {{format(iif_plan_start)}}{{/if}}</div>
        <div class='description'>
          <div class="description-title">Complimentary information provided</div>
          <div class='description-text'>
            {{#if description}}
              {{description}}
            {{else}}
              Not provided
            {{/if}}
          </div>
        </div>
      </div>
    {{/selectedParty}}
  </script>

  <!-- SUMMARY PARTIAL -->
  <script id='summaryPartial' type='text/html'>
    <div class="summary">
      <div class="section-heading">Map of Integrated Investment Frameworks</div>
      <MapViewSelector>
    </div>
  </script>

  <!-- SEARCH PARTIAL -->
  <script id="searchPartial" type="text/html">
    <div class='search'>
      <select decorator='chosen:geosearch' value="{{selectedParty}}" data-observe='parties' data-placeholder="{{partyCount}} Search party, region">
        <option value=""></option>
        {{#each geo_search:category}}
          <optgroup label="{{category}}">
            {{#each .}}            
              {{#iso3}}
                <option value="{{iso3}}">{{party}}</option>
              {{else}}
                <option value="{{category}}:{{.}}">{{.}}</option>
              {{/iso3}}
            {{/each}}
          </optgroup>
        {{/each}}
      </select>
    </div>    
  </script>

  <!-- MAP SELECTOR COMPONENT -->
  <script id='mapViewSelector' type='text/html'>
    <div class="accordion">
      <div class="accordion-section">
        <div on-click='set("mapView", 1)' class="accordion-toggle">IIFs established</div>
        <div class="accordion-content {{#if mapView == 1}}default{{/if}}">
          <p>The map shows {{partyCount}} party parties and regions with IIFs already established.</p>
          <ul>
            {{#each iif_status_filters}}
              <li>{{title}}</li>
            {{/each}}
          </ul>
        </div>
      </div>
      <div class="accordion-section">
        <div on-click='set("mapView", 2)' class="accordion-toggle">IIFs planned</div>
        <div class="accordion-content {{#if mapView == 2}}default{{/if}}">
          <p>These are Voluntary National Targets. These include IIFs with no specific date.</p>
          <p>Look at all these subfilters for each biennium!</p>
          <ul>
            {{#each plan_filters}}
              <li>{{title}}</li>
            {{/each}}
          </ul>
        </div>
      </div>
      <div class="accordion-section">
        <div on-click='set("mapView", 3)' class="accordion-toggle">GM support</div>
        <div class="accordion-content {{#if mapView == 3}}default{{/if}}">
          <p>The map shows parties which are receiving support from GM.</p>
          <ul>
            {{#each gm_support_filters}}
              <li>{{title}}</li>
            {{/each}}
          </ul>
        </div>
      </div>
    </div>
  </script>
  

  <!-- Core libraries -->
  <script src='ext/ractive.min.js'></script>
  <script src='ext/jquery.min.js'></script>
  <script src='ext/lodash.min.js'></script>

  <!-- Backbone + Ractive-adaptor -->
  <script src='ext/backbone.min.js'></script>
  <script src='ext/backbone.obscura.js'></script>
  <script src='ext/ractive-backbone-adaptor.min.js'></script>

  <!-- jVectorMap -->
  <script src='ext/jquery-jvectormap-2.0.4.min.js'></script>
  <script src='ext/jquery-jvectormap-world-merc.js'></script>

  <!-- Chosen + Ractive-adaptor -->
  <script src='ext/chosen.jquery.min.js'></script>
  <script src='js/ractive.chosen.mod.js'></script>

  <!-- Application -->
  <script src='js/collections.js'></script>
  <script src='js/explorer_view.js'></script>
  <script src='js/map.js'></script>
  <script src='js/map-selector.js'></script>
  <script src='js/script.js'></script>


</body>
</html>